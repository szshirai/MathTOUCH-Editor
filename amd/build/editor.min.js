define(["jquery","editor_mathtouch/filepicker"],function(i,n){function o(t,e){var i=t.attr("id");this.textarea=t,this.initparams=e,void 0!==M.editor_mathtouch.fpoptions[e.elementid]&&(this.initparams.filepickeroptions=M.editor_mathtouch.fpoptions[e.elementid]),MathTOUCH.SITEURL=this.initparams.mathtouchpath+"mathtouch/",MathTOUCH.OUTPUTIMGURL=this.initparams.mathtouchpath+"image/",MathTOUCH.init("mathEditor","en",i,""),this.initFilesEmbedding(i)}return o.prototype.initFilesEmbedding=function(t){var e;"filepickeroptions"in this.initparams?(e=this,Y.use("core_filepicker",function(){e.filepicker=n.init(e.initparams.filepickeroptions),e.filepicker.canShowFilepicker("image")&&(MathTOUCH.MTEditor_imgMenu_inputURLBTN.onclick=function(t){document.getElementById("modal").style.display="none",document.getElementById("imgmenu").style.display="none",t.preventDefault();t.target;e.filepicker.showFilepicker("image",function(t){MathTOUCH.MTEditor_imgMenu_inputURL.value=t.url;var e=new Image;e.src=t.url,e.onload=function(){console.log(e),MathTOUCH.MTEditor_imgMenu_inputsize_w.value=e.width,MathTOUCH.MTEditor_imgMenu_inputsize_h.value=e.height},document.getElementById("modal").style.display="block",document.getElementById("imgmenu").style.display="block"})})})):log.error(this.initparams.elementid+": File picker options not found")},o.prototype.imageEmbedded=function(t,e){"url"in t&&this.insertText('<img alt="" class="img-responsive" src="'+t.url+'" contenteditable=true/>',e)},o.prototype.insertText=function(t,e){e=i(MathTOUCH.MTEditor_editArea[e]),t=e.html()+t;e.html(t)},{init:function(t){var e;if(!("elementid"in t))throw new Error("MathTOUCH: Invalid editor init parameter - missing elementid");if((e=i(document.getElementById(t.elementid))).length)return new o(e,t);throw new Error("Unable to find textarea element",t.elementid)}}});